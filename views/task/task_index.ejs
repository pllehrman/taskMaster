<div class="dash-header-wrapper">
    <h2 class="dashboard-header">Live Tasks</h2>
</div>
<% if (flashMessages.success) { %>
    <div class="alert alert-success">
        <%= flashMessages.success %>
    </div>
<% } %>
<% if (flashMessages.error) { %>
    <div class="alert alert-danger">
        <%= flashMessages.error %>
    </div>
<% } %>
<div class="tasks-section">
    <div class="task-section">
        <h2>Tasks I've Assigned:</h2>
        <div class="task-header">
            <div>Organization:</div>
            <div>Task Name:</div>
            <div>Task Responsibility:</div>
            <div>Date Assigned:</div>
            <div>Due Date:</div>
            <div>Learn More:</div>
            <div>Mark Complete:</div>
        </div>
        <ul class="task-list">
            <% tasks.asAssigner.forEach(function(task) { %>
                <div class="task-item">
                    <div>
                        <p class="task-organization-name"><%= task.organization.name %></p>
                    </div>
                    <div>
                        <h3 class="task-title"><%= task.name %></h3>
                    </div>
                    <div>
                        <% if (task.owner) { %>
                            <p class="task-owner"><%= task.owner.name %></p>
                        <% } %>
                        <% if (!task.owner) { %>
                            <p class="task-owner">None Yet</p>
                        <% } %>
                    </div>
                    <div>
                        <p><%= new Date(task.time_assigned).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) %></p>
                    </div>
                    <div>
                        <p><%= new Date(task.time_deadline).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) %></p>
                    </div>
                    <div>
                        <button class="button-base submit-button inspect-button" data-task-id="<%= task._id %>" data-task-description="<%= task.description %>" data-is-assigner="true">Inspect</button>
                    </div>
                    <div>
                        <input type="checkbox" id="task-done-green-<%= task._id %>" class="task-done-checkbox" <%= task.completed ? 'checked' : '' %> onclick="markComplete('<%= task._id %>')" />
                        <label for="task-done-green-<%= task._id %>" class="custom-checkbox-label custom-checkbox-label-green"></label> 
                    </div>
                </div>
            <% }); %>
        </ul>
    </div>

    <div class="task-section">
        <h2>Tasks Assigned To Me:</h2>
        <div class="task-header">
            <div>Organization:</div>
            <div>Task Name:</div>
            <div>Task Assigner:</div>
            <div>Date Assigned:</div>
            <div>Due Date:</div>
            <div>Learn More:</div>
            <div>Take Responsibility:</div>
        </div>
        <ul class="task-list">
            <% tasks.asAssignee.forEach(function(task) { %>
                <div class="task-item">
                    <div>
                        <p class="task-organization-name"><%= task.organization.name %></p>
                    </div>
                    <div>
                        <h3 class="task-title"><%= task.name %></h3>
                    </div>
                    <div>
                        <% if (task.assigner) { %>
                            <p class="task-owner"><%= task.assigner.name %></p>
                        <% } %>
                        <% if (!task.assigner) { %>
                            <p class="task-owner">None</p>
                        <% } %>
                    </div>
                    <div>
                        <p><%= new Date(task.time_assigned).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) %></p>
                    </div>
                    <div>
                        <p><%= new Date(task.time_deadline).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) %></p>
                    </div>
                    <div>
                        <button class="button-base submit-button inspect-button" data-task-id="<%= task._id %>" data-task-description="<%= task.description %>" data-is-assigner="false">Inspect</button>
                    </div>
                    <div>
                        <input type="checkbox" id="task-done-blue-<%= task._id %>" class="task-done-checkbox" <%= task.completed ? 'checked' : '' %> onclick="takeResponsibility('<%= task._id %>')" />
                        <label for="task-done-blue-<%= task._id %>" class="custom-checkbox-label custom-checkbox-label-blue"></label>                   
                    </div>
                </div>
            <% }); %>
        </ul>
    </div>

    <div class="task-section">
        <h2>My Responsibilities:</h2>
        <div class="task-header">
            <div>Organization:</div>
            <div>Task Name:</div>
            <div>Task Assigner:</div>
            <div>Date Assigned:</div>
            <div>Due Date:</div>
            <div>Learn More:</div>
            <div>Mark Complete:</div>
        </div>
        <ul class="task-list">
            <% tasks.asOwner.forEach(function(task) { %>
                <div class="task-item">
                    <div>
                        <p class="task-organization-name"><%= task.organization.name %></p>
                    </div>
                    <div>
                        <h3 class="task-title"><%= task.name %></h3>
                    </div>
                    <div>
                        <p class="task-owner"><%= task.assigner.name %></p>
                    </div>
                    <div>
                        <p><%= new Date(task.time_assigned).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) %></p>
                    </div>
                    <div>
                        <p><%= new Date(task.time_deadline).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) %></p>
                    </div>
                    <div>
                        <button class="button-base submit-button inspect-button" data-task-id="<%= task._id %>" data-task-description="<%= task.description %>" data-is-assigner="false">Inspect</button>
                    </div>
                    <div>
                        <input type="checkbox" id="task-done-green-<%= task._id %>" class="task-done-checkbox" <%= task.completed ? 'checked' : '' %> onclick="markComplete('<%= task._id %>')" />
                        <label for="task-done-green-<%= task._id %>" class="custom-checkbox-label custom-checkbox-label-green"></label>
                    </div>
                </div>
            <% }); %>
        </ul>
    </div>
</div>
<button id="refreshTasks" class="button-base bubble-button blue-bubble-button fixed-button top-right">Refresh Tasks</button>
<a href="/organizations" class='button-base bubble-button grey-bubble-button fixed-button bottom-left'>Back To Dashboard</a>
<a href="/tasks/history" class='button-base bubble-button grey-bubble-button fixed-button bottom-right'>Task History</a>
<div id="inspectModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <!-- Placeholder for dynamic content, such as task description -->
        <!-- This will be directly before the action buttons (if any) -->
        
        <!-- Optional: Delete Task Button, initially hidden -->
        <div class="button-container">
            <button class="button-base submit-button-red" id="deleteTaskButton" style="display: none;">Delete Task</button>
        </div>
        
        <!-- Other buttons/actions can go here, e.g., a "Close" button or additional actions related to the task -->
    </div>
</div>

<script src="/js/checkBox.js"></script>
<script src="/js/inspectModal.js"></script>
<script src="/js/deleteTask.js"></script>